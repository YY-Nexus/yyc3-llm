# 🚀 YanYu-LLM 智能工作流配置

## 📋 项目概述

本目录包含 YanYu-LLM 项目的智能系统自动集成迭代工作流配置。这些工作流旨在实现高适用性、高可用性的智能系统自动集成迭代，确保项目开发、测试、部署的全流程自动化和智能化。

## 🛠️ 工作流文件结构

```
.github/
├── workflows/
│   ├── intelligent-integration.yml  # 智能系统自动集成迭代主工作流
│   ├── monitoring.yml              # 应用监控与健康检查工作流
│   ├── automated-testing.yml       # 自动化测试与质量保证工作流
│   ├── ci.yml                      # 基础持续集成工作流（保留）
│   ├── deploy.yml                  # 基础部署工作流（保留）
│   └── docs.yml                    # 文档检查工作流（保留）
├── config/
│   └── intelligent-system-config.json  # 智能系统配置文件
└── README.md                       # 工作流文档（当前文件）
```

## 📊 核心工作流功能

### 1. 智能系统自动集成迭代 (`intelligent-integration.yml`)

**主要功能：**
- ✅ **智能触发机制**：支持代码推送、PR、定时执行和手动触发
- ✅ **前置检查与准备**：自动检测变更范围，决定测试策略
- ✅ **代码质量与安全扫描**：集成ESLint、Snyk安全扫描
- ✅ **智能部署策略**：
  - 开发环境：标准部署
  - 生产环境：金丝雀部署（20%流量）
  - 金丝雀环境：小规模测试部署（10%流量）
- ✅ **自动回滚机制**：部署失败时自动回滚
- ✅ **部署后通知**：自动触发监控和通知

**触发条件：**
- 推送到 main、develop、feature/*、hotfix/* 分支
- 所有针对 main、develop 的 PR
- 工作日每天凌晨2点自动执行
- 手动触发（支持环境选择）

### 2. 应用监控与健康检查 (`monitoring.yml`)

**主要功能：**
- ✅ **定期健康检查**：每30分钟自动运行健康检查
- ✅ **性能指标收集**：响应时间、错误率等关键指标监控
- ✅ **智能扩缩容评估**：基于负载自动建议扩缩容操作
- ✅ **安全扫描与漏洞监控**：定期安全检查
- ✅ **智能分析与报告**：生成综合分析报告和通知

**触发条件：**
- 部署完成后自动触发
- 每30分钟定时执行
- 手动触发（支持指定部署ID和环境）

### 3. 自动化测试与质量保证 (`automated-testing.yml`)

**主要功能：**
- ✅ **分层测试策略**：
  - 单元测试（带覆盖率检查）
  - 集成测试
  - E2E测试（基于Playwright）
  - 性能测试
  - 无障碍测试
- ✅ **智能测试选择**：基于代码变更范围自动选择测试策略
- ✅ **测试覆盖率要求**：确保单元测试覆盖率不低于85%
- ✅ **综合测试报告**：生成详细的测试结果和分析报告

**触发条件：**
- 代码推送到主要分支（忽略文档变更）
- PR请求（忽略文档变更）
- 每周一凌晨3点完整测试套件
- 手动触发（支持选择测试类型）

## 🔧 配置管理

智能系统配置文件 (`intelligent-system-config.json`) 包含以下关键配置区域：

1. **系统信息**：基本系统标识和版本信息
2. **健康指标**：CPU、内存、错误率等阈值设置
3. **自动扩缩容**：副本数范围和扩缩容阈值
4. **部署策略**：不同环境的部署配置
5. **测试配置**：测试超时、覆盖率要求等
6. **安全设置**：漏洞容忍度和扫描频率
7. **通知配置**：告警和报告通知渠道
8. **智能特性**：自动标签、智能测试选择等功能开关

## 🌐 环境变量与密钥

工作流运行需要以下环境变量配置：

### GitHub 仓库变量 (`Settings > Secrets and variables > Actions > Variables`)

- `DEPLOY_URL`：部署应用的基础URL
- `NAMESPACE`：Kubernetes命名空间
- `DEPLOYMENT_NAME`：Kubernetes部署名称
- `STAGING_URL`：预发环境URL（如适用）
- `PRODUCTION_URL`：生产环境URL（如适用）
- `CANARY_URL`：金丝雀环境URL（如适用）

### GitHub 密钥 (`Settings > Secrets and variables > Actions > Secrets`)

- `KUBE_CONFIG_BASE64`：Base64编码的Kubernetes配置文件
- `SNYK_TOKEN`：Snyk安全扫描令牌
- `SLACK_WEBHOOK_URL`：Slack通知Webhook URL

## 📈 性能监控与优化

工作流包含内置的性能监控机制：

1. **响应时间监控**：追踪API响应时间，设置1000ms阈值
2. **错误率监控**：监控请求错误率，设置5%阈值
3. **资源使用率**：CPU使用率阈值85%，内存使用率阈值80%
4. **吞吐量测试**：定期执行负载测试，确保系统容量

## 🚨 告警与通知

系统支持多渠道告警通知：

- **Slack通知**：部署事件、监控告警、系统分析报告
- **自动Issue创建**：关键失败自动创建GitHub Issue
- **部署状态报告**：详细的部署状态和性能指标报告

## 🎯 最佳实践建议

### 1. 工作流使用指南

- **常规开发**：直接推送到feature分支，触发基本CI流程
- **重要更新**：创建PR到develop分支，进行完整测试
- **生产发布**：使用工作流手动触发，选择production环境
- **性能验证**：在大版本更新前手动触发完整性能测试

### 2. 故障排查

- 检查GitHub Actions运行日志获取详细错误信息
- 查看测试报告和监控数据定位问题
- 利用自动回滚机制在部署失败时快速恢复
- 检查环境变量和密钥配置是否正确

### 3. 自定义与扩展

- 修改 `intelligent-system-config.json` 调整系统参数
- 扩展工作流添加自定义测试或部署步骤
- 集成第三方监控工具增强可观测性
- 添加自定义通知渠道

## 🔄 版本控制

| 版本 | 日期 | 描述 |
|------|------|------|
| 1.2.0 | 2024-10-15 | 完善智能系统自动集成迭代工作流 |
| 1.1.0 | 2024-10-10 | 添加监控和自动化测试工作流 |
| 1.0.0 | 2024-10-01 | 初始版本，基础CI/CD配置 |

## 🤝 维护与支持

- **作者**：YYC团队
- **创建日期**：2024-10-15
- **最后更新**：2024-10-15
- **版本**：1.2.0

---

**保持代码健康，稳步前行！** 🌹