# 项目文件架构规范与整理方案

> 目标：统一项目结构、提升可维护性与可发现性；在不破坏现有业务的前提下，分阶段整理与迁移。

## 一、目标目录结构（Next.js 14 App Router + TypeScript）

```
src/
├── app/                 # Next.js App Router（页面、路由、Server Actions）
├── components/          # 通用组件（按领域/功能分组）
├── hooks/               # 自定义 React Hooks
├── lib/                 # 纯函数、跨模块通用库（不含UI）
├── services/            # 业务服务层（API/数据库/缓存）
├── types/               # TypeScript 类型定义
├── utils/               # 工具函数（格式化、转换、校验）
├── styles/              # 样式文件（Tailwind、全局样式）
└── assets/              # 静态资源（图片、SVG、字体）
```

- 顶层目录（项目根）
  - `app/` 与 Next.js 保持兼容（如已有则逐步迁移至 `src/app/` 或保留根级 `app/`，二选一）
  - `public/` 静态公共资源
  - `config/` 项目配置（环境、模块开关）
  - `docs/` 项目文档

## 二、分类与命名规范

- 组件分类
  - `components/ui/` 基础UI组件（按钮、输入框、对话框）
  - `components/feature/` 业务功能组件（如模板管理、分析模块）
  - `components/layout/` 布局与导航（Header、Sidebar、Shell）
- 文件命名
  - 组件：`PascalCase`（如 `TemplateCard.tsx`）
  - hooks：`camelCase`（如 `useToast.tsx`）
  - 工具函数/服务：`camelCase`（如 `dateUtils.ts`、`projectService.ts`）
- 类型文件
  - 按领域拆分，如：`types/template.ts`、`types/project.ts`；公共类型置于 `types/common.ts`
- 导出规则
  - 组件/模块提供 `index.ts` 汇总导出，避免深层相对路径导入
  - 严禁跨层直接相互引用，统一通过 `@/*` 别名或模块入口导出

## 三、路径与别名（tsconfig）

- 统一使用根别名 `@/*` 指向项目根
- 建议扩展细粒度别名（可选）：
```
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./*"],
      "@src/*": ["./src/*"],
      "@components/*": ["./src/components/*"],
      "@lib/*": ["./src/lib/*"],
      "@hooks/*": ["./src/hooks/*"],
      "@types/*": ["./src/types/*"],
      "@utils/*": ["./src/utils/*"]
    }
  }
}
```

> 说明：为兼容现有路径，迁移初期保留 `@/*`，逐步以更明确的别名替代。

## 四、迁移分阶段计划

- 第一阶段（基础规范与不破坏性变更）
  - [x] 统一包管理器为 `npm`，清理非匹配锁文件（`pnpm-lock.yaml`）
  - [x] 确认 VSCode 设置：`npm.packageManager = "npm"`
  - [ ] 在 `docs/` 内建立结构规范与迁移清单（本文件）
  - [ ] 在 `tsconfig.json` 增加细粒度路径别名（保持兼容）

- 第二阶段（类型与工具迁移）
  - [ ] 将 `types/` 迁移至 `src/types/`，同时通过别名兼容老路径
  - [ ] 将 `lib/` 和 `utils/` 分离：`lib` 放通用库，`utils` 放工具函数
  - [ ] 统一 `services/` 目录，沉淀数据库、API、缓存等服务（PostgreSQL/Redis）

- 第三阶段（组件与页面整理）
  - [ ] `components/` 按 `ui/layout/feature` 分类
  - [ ] 对 `app/` 页面做分区整理（按路由与模块）
  - [ ] 建立组件导出入口文件 `index.ts`，减少深层相对导入

- 第四阶段（严格健康度与质量）
  - [ ] ESLint/Prettier/Husky 钩子完善（commit 前类型检查、lint）
  - [ ] 健康度监控（API健康、性能、事件循环、内存使用）集成与仪表盘化

## 五、重构实施清单（示例）

- 立即项
  - 清理 `pnpm-lock.yaml`（使用 npm 作为首选包管理器）
  - 在 `docs/` 增加本规范文件
- 短期项（1-2天）
  - 更新 `tsconfig.json` 路径别名，新增 `@src/*`、`@components/*` 等
  - 新建 `src/services/` 并迁移已有服务代码（API 调用、Redis 缓存逻辑等）
- 中期项（3-5天）
  - 迁移 `types/` 到 `src/types/`，统一引用路径
  - 梳理 `components/` 至 `ui/layout/feature`
- 后续项
  - 积累健康度指标与仪表盘（结合现有 `lib/monitoring`）

## 六、风险与回滚

- 风险：大规模移动文件可能引起路径和导入失败
- 降低风险：每次移动小范围、引入别名兼容；配合类型检查与单元测试
- 回滚策略：保留每次迁移的变更清单；如出问题，按照清单逐步回退

## 七、规范约束（执行关注点）

- 统一使用 `npm`（删除 `pnpm-lock.yaml`、无需 `yarn.lock`）
- 保持 `strict` 类型检查，禁止跳过 `skipLibCheck`（仅在必要时开启）
- 模块间只通过明确的入口导出进行依赖关系维护

---

重要建议：目录迁移务必分阶段进行，先铺别名、后做移动，并保持类型检查与测试绿灯，避免一次性大改造成连锁问题。🌹
